<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PixiJS Spinner Preview â€” spinner-verbs</title>
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg: #0d1117;
      --bg-raised: #161b22;
      --border: #30363d;
      --text: #e6edf3;
      --text-muted: #8b949e;
      --text-faint: #6e7681;
      --accent: #4ade80;
      --mono: 'SF Mono', 'Fira Code', 'Cascadia Code', monospace;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: var(--mono);
      overflow: hidden;
      height: 100vh;
      -webkit-font-smoothing: antialiased;
    }

    #canvas-wrap {
      position: relative;
      width: 100vw;
      height: 100vh;
    }

    #canvas-wrap canvas {
      display: block;
      width: 100% !important;
      height: 100% !important;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
    }

    /* ---- Controls overlay ---- */
    .controls {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.8rem 1.2rem;
      background: rgba(13, 17, 23, 0.85);
      backdrop-filter: blur(8px);
      border-bottom: 1px solid var(--border);
      z-index: 10;
      gap: 0.8rem;
      flex-wrap: wrap;
      font-size: 0.8rem;
    }

    .controls__left {
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }

    .controls__title {
      font-weight: 700;
      color: var(--accent);
      white-space: nowrap;
    }

    .controls__title::before {
      content: '> ';
      color: var(--text-faint);
    }

    .controls__right {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      flex-wrap: wrap;
    }

    .controls select, .controls button {
      background: var(--bg);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 0.35rem 0.6rem;
      font-family: var(--mono);
      font-size: 0.75rem;
      cursor: pointer;
      transition: border-color 0.15s;
    }

    .controls select:hover, .controls select:focus,
    .controls button:hover, .controls button:focus {
      border-color: var(--accent);
      outline: none;
    }

    .controls button.active {
      background: var(--accent);
      color: var(--bg);
      border-color: var(--accent);
    }

    .controls__label {
      color: var(--text-faint);
      font-size: 0.72rem;
    }

    .controls__link {
      color: var(--text-faint);
      text-decoration: none;
      font-size: 0.72rem;
      transition: color 0.15s;
    }

    .controls__link:hover { color: var(--accent); }

    @media (max-width: 600px) {
      .controls { padding: 0.5rem 0.8rem; }
    }
  </style>
</head>
<body>
  <!--SETS_DATA-->

  <div class="controls">
    <div class="controls__left">
      <span class="controls__title">spinner preview</span>
      <a href="index.html" class="controls__link">&larr; gallery</a>
    </div>
    <div class="controls__right">
      <label class="controls__label" for="set-select">set:</label>
      <select id="set-select"></select>
      <button id="toggle-fx">LCD: OFF</button>
    </div>
  </div>

  <div id="canvas-wrap"></div>

  <script src="https://cdn.jsdelivr.net/npm/pixi.js@7.4.2/dist/pixi.min.js"></script>
  <script>
  (function () {
    'use strict';

    /* ---- Constants ---- */

    var SPINNER_FRAMES = ['\u00b7', '\u273b', '\u273d', '\u2736', '\u2733', '\u2722'];
    var SPINNER_TIMELINE = [0, 0, 1, 2, 3, 4, 5, 5];
    var FRAME_MS = 90;
    var VERB_MS = 2200;
    var TOKEN_RATE = 40;

    var COLOR_VERB = 0xd78787;
    var COLOR_ELLIPSIS = 0xffaf87;
    var COLOR_META = 0x555555;
    var BG_COLOR = 0x0d1117;

    var FONT_MAIN = 56;
    var FONT_META = 40;
    var FONT_FAMILY = '"SF Mono", "Fira Code", "Cascadia Code", monospace';

    /* ---- Helpers ---- */

    function shuffle(arr) {
      var a = arr.slice();
      for (var i = a.length - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        var t = a[i]; a[i] = a[j]; a[j] = t;
      }
      return a;
    }

    function getAllVerbs(sets) {
      var all = [];
      var keys = Object.keys(sets);
      for (var k = 0; k < keys.length; k++) {
        var group = sets[keys[k]];
        for (var g = 0; g < group.length; g++) {
          if (group[g].verbs) all = all.concat(group[g].verbs);
        }
      }
      return all;
    }

    function getSetVerbs(sets, name) {
      var keys = Object.keys(sets);
      for (var k = 0; k < keys.length; k++) {
        var group = sets[keys[k]];
        for (var g = 0; g < group.length; g++) {
          if (group[g].name === name) return group[g].verbs || [];
        }
      }
      return [];
    }

    function fmtElapsed(ms) {
      var s = Math.floor(ms / 1000);
      if (s < 60) return s + 's';
      return Math.floor(s / 60) + 'm ' + (s % 60) + 's';
    }

    /* ---- PixiJS setup ---- */

    PIXI.settings.SCALE_MODE = PIXI.SCALE_MODES.NEAREST;
    PIXI.settings.ROUND_PIXELS = true;

    var wrap = document.getElementById('canvas-wrap');
    var app = new PIXI.Application({
      resizeTo: wrap,
      resolution: window.devicePixelRatio * 0.125,
      autoDensity: true,
      backgroundColor: BG_COLOR,
      antialias: false,
    });
    wrap.appendChild(app.view);

    /* ---- LCD subpixel overlay ---- */

    var dpr = window.devicePixelRatio || 1;
    var cellSize = 1 / (dpr * 0.125);

    var lcdOverlay = document.createElement('div');
    lcdOverlay.id = 'lcd-overlay';
    lcdOverlay.style.cssText = 'position:absolute;inset:0;pointer-events:none;mix-blend-mode:multiply;image-rendering:pixelated;display:none;';
    wrap.appendChild(lcdOverlay);

    function buildLcdPattern() {
      var c = document.createElement('canvas');
      c.width = 4; c.height = 4;
      var ctx = c.getContext('2d');
      // AGS-001 inspired subpixel factors
      var cols = [
        [255, 51, 51],   // R subpixel
        [51, 255, 51],   // G subpixel
        [51, 51, 255],   // B subpixel
        [102, 102, 102], // gap
      ];
      for (var row = 0; row < 4; row++) {
        var scanFactor = row === 3 ? 0.9 : 1.0;
        for (var col = 0; col < 4; col++) {
          var rgb = cols[col];
          var r = Math.round(rgb[0] * scanFactor);
          var g = Math.round(rgb[1] * scanFactor);
          var b = Math.round(rgb[2] * scanFactor);
          ctx.fillStyle = 'rgb(' + r + ',' + g + ',' + b + ')';
          ctx.fillRect(col, row, 1, 1);
        }
      }
      return c.toDataURL();
    }

    var lcdPatternUrl = buildLcdPattern();
    lcdOverlay.style.backgroundImage = 'url(' + lcdPatternUrl + ')';
    lcdOverlay.style.backgroundSize = (cellSize) + 'px ' + (cellSize) + 'px';

    window.addEventListener('resize', function () {
      dpr = window.devicePixelRatio || 1;
      cellSize = 1 / (dpr * 0.125);
      lcdOverlay.style.backgroundSize = (cellSize) + 'px ' + (cellSize) + 'px';
    });

    /* ---- Text objects ---- */

    var styleMain = { fontFamily: FONT_FAMILY, fontSize: FONT_MAIN, fill: COLOR_VERB };
    var styleEllipsis = { fontFamily: FONT_FAMILY, fontSize: FONT_MAIN, fill: COLOR_ELLIPSIS };
    var styleMeta = { fontFamily: FONT_FAMILY, fontSize: FONT_META, fill: COLOR_META };

    var glyphText = new PIXI.Text(SPINNER_FRAMES[4], styleMain);
    var verbText = new PIXI.Text('Loading', styleMain);
    var ellipsisText = new PIXI.Text('\u2026', styleEllipsis);
    var metaText = new PIXI.Text('', styleMeta);

    var spinnerLine = new PIXI.Container();
    spinnerLine.addChild(glyphText, verbText, ellipsisText);

    var metaLine = new PIXI.Container();
    metaLine.addChild(metaText);

    app.stage.addChild(spinnerLine, metaLine);

    /* ---- Layout ---- */

    function layout() {
      var gap = 10;
      verbText.x = glyphText.width + gap;
      ellipsisText.x = verbText.x + verbText.width;

      var lineW = ellipsisText.x + ellipsisText.width;
      var leftX = Math.round((app.screen.width - lineW) / 2);
      spinnerLine.x = leftX;
      spinnerLine.y = Math.round(app.screen.height / 2 - glyphText.height);

      metaLine.x = leftX;
      metaLine.y = Math.round(spinnerLine.y + glyphText.height + 8);
    }

    /* ---- LCD toggle state ---- */

    var fxEnabled = false;

    /* ---- State ---- */

    var verbs = [];
    var verbIdx = 0;
    var spinnerTick = 0;
    var tokenCount = 0;
    var startTime = Date.now();
    var lastFrameTime = 0;
    var lastVerbTime = 0;
    var lastTokenTime = 0;

    /* ---- Animation loop ---- */

    app.ticker.add(function () {
      var now = Date.now();

      // spinner glyph
      if (now - lastFrameTime >= FRAME_MS) {
        spinnerTick++;
        var fi = SPINNER_TIMELINE[spinnerTick % SPINNER_TIMELINE.length];
        glyphText.text = SPINNER_FRAMES[fi];
        lastFrameTime = now;
      }

      // verb cycling
      if (verbs.length > 0 && now - lastVerbTime >= VERB_MS) {
        verbIdx = (verbIdx + 1) % verbs.length;
        verbText.text = verbs[verbIdx];
        lastVerbTime = now;
      }

      // token count (simulate ~40 tokens/s)
      if (now - lastTokenTime >= 1000) {
        tokenCount += TOKEN_RATE + Math.floor(Math.random() * 20 - 10);
        lastTokenTime = now;
      }

      // metadata
      var elapsed = fmtElapsed(now - startTime);
      metaText.text = '(esc to interrupt \u00b7 ' + elapsed + ' \u00b7 \u2193 ' + tokenCount + ' tokens \u00b7 thinking)';

      layout();
    });

    /* ---- Controls ---- */

    var sets = (typeof SETS !== 'undefined') ? SETS : {};
    var selectEl = document.getElementById('set-select');
    var fxBtn = document.getElementById('toggle-fx');

    // populate select
    var opts = '<option value="all">All sets (shuffled)</option>';
    var keys = Object.keys(sets);
    for (var k = 0; k < keys.length; k++) {
      var group = sets[keys[k]];
      for (var g = 0; g < group.length; g++) {
        var s = group[g];
        opts += '<option value="' + s.name + '">' + s.name + ' (' + (s.verbs ? s.verbs.length : 0) + ')</option>';
      }
    }
    selectEl.innerHTML = opts;

    function loadVerbs(setName) {
      if (setName === 'all') {
        verbs = shuffle(getAllVerbs(sets));
      } else {
        verbs = shuffle(getSetVerbs(sets, setName));
      }
      if (verbs.length === 0) verbs = ['Thinking', 'Processing'];
      verbIdx = 0;
      tokenCount = 0;
      startTime = Date.now();
      verbText.text = verbs[0];
    }

    selectEl.addEventListener('change', function () {
      loadVerbs(selectEl.value);
    });

    fxBtn.addEventListener('click', function () {
      fxEnabled = !fxEnabled;
      lcdOverlay.style.display = fxEnabled ? 'block' : 'none';
      fxBtn.textContent = 'LCD: ' + (fxEnabled ? 'ON' : 'OFF');
      fxBtn.classList.toggle('active', fxEnabled);
    });

    /* ---- Init ---- */

    loadVerbs('all');
    layout();
  })();
  </script>
</body>
</html>
